# システムとネットワークのセキュリティ
## 概要（当初版）
サーバクライアントモデル、サーバ管理の立場から、スパイウェアやインジェクションなどのサーバを攻撃する手法、大規模な組織的攻撃について述べる。また、パブリッククラウドに依存した業務の際のクラウドを使うユーザ（個人、ユーザ企業）が考えるべき情報セキュリティにや、ファイアウォールについて述べる。

## キーワード（当初版）
サーバ、クライアント、標的型攻撃

## 概要（学習のポイント）＜改訂版＞

## キーワード＜改訂版＞


# ネットワークのセキュリティ

インターネットを介してサービス提供を行うシステムが一般的なものとなっている。
エンドユーザは情報の検索や、ショッピング、動画や音楽の視聴、地図の閲覧、SNSによる交流など
さまざまな活動をインターネットを介してサービスにより行っている。

こういったサービスを提供しているシステムのセキュリティを考えるときに、
システム自身もインターネット上の端末として存在し、TCP/IP技術を用いて通信を行っていることから
ネットワークの視点でセキュリティを考えることが重要となる。

TCP/IPではネットワークは分離され、それぞれが相互に接続することによりインターネットが構成されている。
それぞれのネットワークが相互に接続する境界点に置かれる機器はルータやゲートウェイと呼ばれ、
ネットワーク内外の通信を仲立ちする。
境界点において組織内の通信と組織外からの通信を管理運用することでネットワークのセキュリティを実現するアプローチが存在する。


## ファイアウォール
TCP/IPでは、それぞれの端末はIPアドレスを持ちIP通信を行い、ポート番号により提供するサービスを変えTCP/UDP通信を行う。
Webサーバやメールサーバといったシステムは、それらの通信によりサービスを提供する。
一方でWebサーバやメールサーバは、限定された端末による外部へのサービスの提供であるため、組織内すべてのIPアドレスへすべてのTCP/UDP通信を許可する必要はない。それらのアクセスを制限することで不要な通信を抑え、不正なアクセスを防ぐことができる。

ファイアウォールはネットワークの境界点に設置されるアクセス制御の機器あるいはサービスを言う。
IPアドレスやTCP/UDPのポート番号など、通信パケットのヘッダを見てアクセス制御を行うパケットフィルタリング型や、
TCP/UDPのアクセスを代理で引き受ける通信を制御するサーキットレベルゲートウェイ型、より上位のアプリケーションレベルで挙動や内容の確認と制御を行うアプリケーションゲートウェイ型に大別することができる。
いずれも許可された通信だけを通し、許可されていない通信は遮断し管理者にその情報を通知する。

## IDS/IPS
ファイアウォールは許可された通信だけに限定することで不要な通信を防ぎセキュリティを実現するものであるが、
許可された通信に紛れて不正なアクセスがされる恐れもある。

そこで、通信内容を監視し不正アクセスを検知そして対処する機器あるいはサービスであるIDS（Intrusion Detection System、侵入検知システム）やIPS（Intrusion Prevention System）が用いられる。
IDSは攻撃を検知しその情報を管理者に通知する。IPSは、検知すると同時に通信の遮断などの防御策を講じる。

IDS/IPSが行う検知は、あらかじめ登録されている不正アクセスのパターンを用いて通信を監視しパターンと一致する通信を検知そして防御するパターンマッチング手法や、通常の通信状態を記憶しておき通常の通信とは異なる振る舞いを検知そして防御する異常（アノマリ）検知手法がある。

IDS/IPSはネットワークの境界点やその近くに設置されることでネットワーク全体の不正アクセス検知と対処をするものや、それぞれの端末に搭載されることで機器への不正アクセス検知と対処をするものがある。


## セグメントの分離

多くの組織では、組織内で従業員などが用いるPCといったクライアント端末と、組織外や組織内にサービスを提供するサーバ端末の双方を持つ。これらが同じネットワーク内に存在している場合、ファイアウォールやIDS/IPSなどを設置していたとしても一部の通信は外部から組織内に対して開かれているため、クライアント端末や組織内向けのサーバ端末に不正なアクセスが行われる可能性がある。

それらを避けるために、組織内でネットワークのセグメントを分割し、外部アクセスがある端末が置かれるセグメントと内部のクライアント端末が置かれるセグメントを設けることで不要なアクセスを制限していく方法が取られる。
このときに外部アクセスがある端末が置かれるセグメントをDMZ（DeMilitarized Zone、非武装地帯）と呼ばれる。

図4は簡単なセグメント分割を示した図である。
DMZと組織内プライベートネットワークがあり、それらの接続点にファイアウォールが置かれ通信が制御されている。

![Figure1](figure04.png)


## VPN（Virtual Private Network）
DMZなどを用いて組織内ネットワークをセグメントごとに分割することで、外部から組織内プライベートネットワークへのアクセスを遮断することが可能となる。
しかし、複数拠点がある組織において拠点間のプライベートネットワークを繋ぎたいときや、リモートワーク等で適切なユーザが外部からプライベートネットワークに繋ぎたいというケースが現れる。
そういったときにVPNが利用される。

VPNは拠点の境界点同士を接続しする拠点間VPNと、外部から単一の端末が接続するリモートアクセスVPNに大別される。
いずれも組織内のプライベートネットワークに接続するために認証が行われ、仮想的に同一のネットワーク内にいるように振る舞うために通信はトンネリングされる。また通信は第3者に覗き見されないように暗号化される。
L2TP（Layer 2 Tunneling Protocol）やIPsecがプロトコルとしてVPNに用いられることが多い。
リモートアクセスVPNにはクライアント側がより容易に利用可能なSSL-VPNが使われることもある。





# システムのセキュリティ
ネットワーク境界にファイアウォールやIDS/IPSなどの防御機器を導入することで
外部からの不正アクセスにネットワークとして対応を行うことができる。

一方で、正規の通信に紛れるあるいは擬態して不正にシステムに攻撃が行われることもあるため、システムにおいてもセキュリティの対s買うをすることが求められる。

現代のクライアント-サーバシステムではサービス提供を単一のサーバで行うことは稀であり、システムそのものがネットワークを構成することが多い。ネットワーク化されたシステムとしてサービスを提供する形になっている。本節ではまずクライアント-サーバシステムについて解説をし、その後サーバ機器単体でのセキュリティ対策について解説を行う。

## 3層アーキテクチャ
3層アーキテクチャとは、クライアント-サーバシステムにおいてシステムの構成要素を以下の3つに分割し、それぞれの層で機能を構成するアーキテクチャを指す
- プレゼンテーション層
- アプリケーション層
- データベース層

プレゼンテーション層では、ユーザのリクエストを受け、処理が必要な場合にアプリケーション層に処理を依頼する。またアプリケーション層からの処理結果を受け、それをユーザに返す作業も行う。
アプリケーション層ではプレゼンテーション層からの要求を受け、さまざまな処理を行う。
処理の内容に応じて、必要なデータの検索や保存、削除といった処理をデータ層に依頼をする。
データ層ではシステムにおけるデータが管理され、アプリケーション層からの依頼に応じてデータの検索や保存、削除を行いその結果を返す。
それぞれの層では冗長構成をとるために複数の機器が設置されることがあり、お互いがTCP/IP通信を行うことで1つのネットワークを構成する。

セキュリティの視点では、プレゼンテーション層の前にファイアウォールやIDS等を設置して
不正なアクセスなどをシステムを構成するネットワークの境界部分で制御することが行われる。

図5にWebシステムにおける3層アーキテクチャの例を示す。
インターネットから接続される通信路が二重化されており、システムの境界部分にファイアウォールが設置されている。多くのリクエストを複数のサーバに分散させるロードバランサが各Webサーバの前に位置し、ここでも冗長構成が取られている。
ウェブサーバとアプリケーションサーバは別のネットワークセグメントとして繋がっており、さらにアプリケーションサーバ群とデータベースがさらに異なるネットワークセグメントとして繋がっていることがわかる。

![Figure1](figure05.png)


## 脆弱性対策
システムを構成するサーバ等の機器それぞれにOSやソフトウェアのレベルでの対策が施される。
対策は複数の視点に及ぶがここでは脆弱性の対策に焦点をあて、さらにその中でもソフトウェアの脆弱性の原因とその対策手法について解説を行う。

### バッファオーバーフロー、スタックオーバーフロー
OSやソフトウェアの脆弱性で代表的なものがこのバッファオーバーフロー、あるいはスタックオーバーフローと呼ばれる脆弱性である。
現代のコンピュータはノイマン型コンピュータと呼ばれる構成がされており、コンピュータ上で動くプログラムやデータはすべて同一のメモリ上に展開される。

コンピュータは実行時にあらかじめ利用されるメモリを確保した後にプログラムを実行する。
プログラム中で読み込まれたデータはこの確保されたメモリ上に展開されることになる。
ここで確保されたメモリと読み込まれたデータの処理や管理が適切にされていない場合、
確保されたメモリ以上の量のデータが読み込まれ、しかも確保された領域を超えてデータが書き込まれてしまうことが起きる。
これがバッファオーバーフローの基本的な現象である。

マルウェアなどはこのバッファオーバーフローや類似したスタックオーバーフローを悪用し、確保された領域を超えたエリアにもともと存在していたプログラムを上書きするなどして、プログラムを侵害し、プログラムの停止やデータ破壊、盗用、はコンピュータの実行権限奪取などを行う。

バッファオーバーフローやスタックオーバーフローはソフトウェアやOSの代表的な脆弱性であるため、さまざまな対策が提案され実装されている。
ここではそのいくつかを次節以降で紹介する。



### コンパイラによる検知
コンパイル時にコンパイラがオーバーフローを検知

### 実行負荷属性の利用
DEP、NXビット、XDビット

### メモリ空間のランダム化
ASLR

## ハードウェアによるセキュリティ
TEEの話

# 境界型防御からの移行
ファイアウォール、VPNなどセキュリティとしての機能を持たせた機器をネットワークの境界に配置しネットワークを分離して、ネットワーク内部にいる端末は無条件に信用して組織内のリソースへのアクセスを自由に許可するという情報通信を行うというケースは、いろいろと問題が出てきた。（文章が長いな）

クラウドコンピューティングとクラウドを利用したサービスの業務利用：GoogleのGsuite、Microsoft Office 365、などなど。
組織内のリソースは組織の外部ネットワークからも使えるし、そもそものリソースが組織外に置かれることも増えた。

またシステム自体もそれぞれの機器が仮想化され、クラウドにより管理・運用されるということが増えてきた。Software Defined Networkなんかはその代表例。それぞれの機器の設定を一元管理するコントロールプレーンと、コントロールプレーンからの指示により通信の制御や機器の性質を変化させるデータプレーンに分かれ、データプレーンに設置される機器は設定によりファイアウォールにもVPNサーバにもルータにも仮想的になれるというものになった。

仮想化とクラウドコンピューティングの進展は従来型のシステムに大きな変革をももたらすとともに、そのセキュリティにも変化が起こった。

これまでのネットワーク内部ならば信用し内部リソースに自由にアクセス可能するというようなモデルは通用しなくなってきた。
攻撃が高度化し、いくつかの手段を駆使して段階を踏んでネットワーク内部に侵入することもある。

境界型の防御手法だけではセキュリティの確保が難しくなってきた。

# ゼロトラストネットワーク
そこで注目されてきたのがゼロトラストネットワークという考え方である。

ゼロトラストネットワークはそれ単体で特定の技術を指すものではない。境界型防御にあるようなローカルネット内だから信じるという考えを捨て、ネットワークに信頼をおかず細かい単位でも認証と認可とデータの保護を適切に行うことでネットワークやシステムのセキュリティを確保するというものである。


認証では、利用するユーザの認証だけでなく、利用される端末を含めた認証を行う。そしてその認証に応じたリソースへのアクセス認可を行う。
端末を認証する際にセキュリティチップを使ったりすることもあるよ。いまのラップトップだと大体あるし。
TPM。PKI。

さらに進むと、端末のみならずその端末で稼働するソフトウェア・アプリケーションに対する認証と認可も考えうる。
コード署名は配付元の保証だけど、それに加えてそのソフトウェア自身の認証としてアプリケーションの内容自体やその流通経路も対象になることも今後は考えられるだろう。

# 監視
監視についても触れたほうがいいな。
各機器はいっぱいログを出す。統合的にログを集約して観測することで攻撃を含めた異常状態の監視をするよ。

またその監視を専門で行う組織を社内に作ることSOCやそれを外部委託するケースもあるよ。

またインシデント発生時の対応チームを組織内に作ることもあるよ：CSIRT。
CSIRTってどんなことするか、とか。

